import SpectrumChart from "./utility/SpectrumChart.js"
import FetchAPI from "./utility/FetchAPI.js"

const spectrumCart = new SpectrumChart();
const fetchAPI = new FetchAPI();

mainAsync();

let test =[
    [
        parseFloat(148.1120),
        parseFloat(0.3955)
    ],
    [
        176.1070,
        100.0000
    ],
    [
        220.1332,
        7.2666
    ],
    [
        265.1911,
        13.1457
    ]
]
let test1 =[
    [
        parseFloat(148.1120),
        parseFloat(0.3955)
    ],
    [
        176.1070,
        100.0000
    ],
    [
        220.1332,
        7.2666
    ],
    [
        265.1911,
        13.1457
    ]
]
let test2= {
    "id": 128984,
    "compoundDataId": 12505,
    "compoundClassificationId": 32,
    "authorId": 0,
    "msLevel": 2,
    "precursorMz": 303.173,
    "exactMass": 0,
    "collisionEnergy": "0",
    "mzError": -1.0125,
    "lastModify": "2023-10-01T20:24:55.000+00:00",
    "dateCreated": "2023-10-01T20:24:55.000+00:00",
    "dataSourceArrayList": [
        "['GNPS', 'LC-MS']"
    ],
    "instrument": "Orbitrap",
    "ionMode": "positive",
    "ms2Spectrum": "79.053978:0.328417 81.033356:0.209342 81.069832:1.071206 82.039986:0.042865 83.049065:0.552924 83.085518:0.093370 84.051804:0.049715 85.028435:0.443774 85.064697:0.506401 86.031876:0.044049 86.096573:0.068103 87.043785:0.209483 89.059219:0.044676 91.053818:0.438873 93.069725:0.763916 94.039490:0.049129 94.073166:0.063691 95.012482:0.042035 95.048965:0.826779 95.085190:0.807715 96.051888:0.085370 97.010208:0.049609 97.028214:0.106307 97.064636:0.630889 97.100990:0.045364 98.059654:0.075943 98.071327:0.408898 99.043816:0.937426 99.080185:0.375846 100.047165:0.196653 101.059334:0.272515 103.038528:0.114356 105.033417:0.058666 105.069611:0.698293 107.048798:0.264607 107.085274:0.790592 108.088715:0.051600 109.027718:0.052409 109.050911:0.073352 109.064568:0.763817 109.100883:0.434347 110.060158:0.084294 110.067474:0.076614 111.026230:0.195261 111.043800:0.274581 111.066231:0.097020 111.080246:0.693211 112.075211:0.091995 112.082329:0.048976 113.059448:0.540047 113.078186:0.049783 113.095825:0.085786 115.038681:0.098746 115.074997:0.074316 117.069527:0.258195 119.048965:0.069841 119.085320:0.925506 119.265701:0.061852 120.080795:0.078162 120.088089:0.132134 121.064880:0.411083 121.100990:0.764788 122.059608:0.076813 122.067673:0.068357 122.633636:0.057757 123.043633:0.222859 123.066231:0.204498 123.080093:0.728572 123.116432:0.091841 124.074982:0.090269 124.083542:0.089374 125.059296:0.469519 125.096077:0.541597 126.062675:0.062462 127.038712:0.248346 127.074928:0.582933 127.110840:0.056796 128.070099:0.054973 129.054138:0.170830 129.069962:0.173576 129.090820:0.080771 131.085449:0.443990 132.088593:0.060278 133.064087:0.112683 133.100784:0.763418 134.104462:0.183977 135.044067:0.082983 135.080154:0.844536 135.116379:0.326235 136.061356:0.311625 136.074585:0.080486 136.084030:0.419851 137.059601:0.606508 137.095551:0.488639 138.076797:0.214702 139.038422:0.102979 139.075104:0.491335 139.111465:0.250116 141.054230:0.384082 141.069550:0.071082 141.090836:0.309323 141.505890:0.116960 143.069931:0.107488 143.085434:0.421511 144.088821:0.054933 145.048904:0.067058 145.064224:0.237522 145.100906:0.818969 146.104416:0.056943 147.079773:0.417395 147.090775:0.049163 147.116592:0.551655 148.119324:0.068107 149.059631:0.113003 149.095932:0.568857 149.132172:0.065051 150.099991:0.195259 151.075211:0.503308 151.111252:0.247405 152.078064:0.059431 152.114548:0.049398 153.054199:0.226902 153.072647:0.054121 153.090546:0.396735 154.094879:0.068297 154.158859:0.065931 155.070129:0.186401 155.085846:0.163014 155.105972:0.184165 157.063873:0.066458 157.088135:0.065182 157.100891:0.604921 157.121765:0.064547 159.080063:0.305428 159.116272:0.418395 160.122025:0.058335 161.059174:0.074740 161.095749:0.766408 161.107040:0.121679 161.132294:0.325129 162.099152:0.257413 163.038559:0.075364 163.074768:0.352249 163.111389:0.797823 165.088013:100.000000 166.095505:0.052827 167.069550:0.230629 167.084167:0.102740 167.106003:0.286686 168.110489:0.178045 169.063461:0.047010 169.085236:0.353362 169.100800:0.320881 169.610046:0.055181 171.079834:0.275220 171.101913:0.095465 171.116043:0.581701 172.120483:0.205926 173.095047:0.418682 173.131897:0.277000 174.099731:0.086168 175.074951:0.286674 175.111176:0.681949 176.115143:0.087047 177.053604:0.053532 177.090149:0.261986 177.103119:0.097788 177.127579:0.095762 179.053650:0.043984 179.069687:0.297053 179.089783:0.084316 179.105576:0.778558 180.073257:0.059946 180.109711:0.233223 181.085129:0.288527 181.119690:0.733176 183.063889:0.068231 183.080002:0.106930 183.100311:0.344084 183.116531:0.202331 185.059738:0.052859 185.080521:0.098031 185.095856:0.278052 185.131973:0.316906 186.098938:0.069245 187.059311:0.069259 187.075119:0.097963 187.096069:0.054348 187.111542:0.406609 187.148102:0.068035 189.089706:0.358050 189.127182:0.318741 190.094086:0.116687 190.129654:0.263139 191.069168:0.075093 191.106293:0.309311 192.109879:0.221946 193.085434:0.250219 193.100998:0.083101 193.121414:0.259203 194.089264:0.212846 195.098450:60.942033 197.058319:0.073613 197.079819:0.079478 197.095932:0.207249 197.115036:0.168132 197.132507:0.299981 199.073288:0.052240 199.111130:0.246490 199.147522:0.063337 201.089096:0.103995 201.127289:0.243007 203.105499:0.603126 203.143021:0.193911 204.109818:0.344313 204.145950:0.202588 205.083252:0.067249 205.122635:0.242281 206.125397:0.069860 207.063705:0.060848 207.101105:0.430400 207.138046:0.196464 208.104126:0.236638 209.062851:0.064616 209.116150:0.263523 211.059448:0.259908 211.076630:0.112453 211.094635:0.100855 211.111237:0.158370 211.131165:0.176265 211.147659:0.180879 212.101959:0.061651 213.091141:0.085769 213.108978:0.535821 213.127396:0.169165 213.162140:0.078119 214.128738:0.221980 215.070480:0.093919 215.106354:0.267336 215.142624:0.093857 217.122452:0.111788 219.138214:0.168581 221.079300:0.070290 221.098404:0.133948 221.116608:0.648520 221.152023:0.175756 222.120682:0.517167 222.157349:0.076266 225.054977:0.058613 225.092255:0.223660 225.110565:0.096114 225.128754:0.105035 225.146469:0.132829 226.083420:0.067275 226.113571:0.066205 229.051590:0.059700 229.084213:0.059476 229.119202:0.087376 229.135483:0.059717 231.100677:0.168777 231.136963:0.453017 232.105911:0.344486 232.140411:0.825810 234.104202:0.055635 235.095322:0.079883 237.147903:0.090414 239.070496:0.222798 239.104736:0.338995 239.126709:0.203699 240.064636:0.063516 240.101349:0.058019 240.129242:0.304524 241.140137:3.027909 243.065445:0.233437 243.113983:0.345385 243.138702:0.185762 249.112061:0.409495 249.147888:0.614015 249.182968:0.074253 250.077469:0.062937 250.114929:0.846863 250.151413:1.624770 253.107483:0.081438 257.044067:0.070909 257.079559:0.101394 257.092712:0.081881 257.125977:0.919003 257.154938:0.367683 257.190247:0.096396 258.111694:0.115598 259.146698:0.206672 259.179230:0.083760 262.112213:0.057111 267.027954:0.084763 267.102173:0.124510 267.118408:0.103077 267.138458:0.083781 267.158539:0.289660 268.093781:0.074401 268.124878:1.149848 268.160980:0.813304 271.106842:1.444186 271.150085:1.656543 275.138367:0.055169 285.038849:0.264204 285.076721:0.482214 285.118042:1.561155 285.155823:0.912604 286.076569:0.075840 286.105652:0.172153 286.136902:0.585329 286.165497:0.082419 288.210114:0.106056 289.160889:0.556364 303.047943:0.267741 303.088531:0.472894 303.130554:3.258822 303.174927:12.670989 303.211670:2.771009",
    "ms2SpectrumList": [
        [
            "79.0540",
            "0.3284"
        ],
        [
            "81.0334",
            "0.2093"
        ],
        [
            "81.0698",
            "1.0712"
        ],
        [
            "82.0400",
            "0.0429"
        ],
        [
            "83.0491",
            "0.5529"
        ],
        [
            "83.0855",
            "0.0934"
        ],
        [
            "84.0518",
            "0.0497"
        ],
        [
            "85.0284",
            "0.4438"
        ],
        [
            "85.0647",
            "0.5064"
        ],
        [
            "86.0319",
            "0.0440"
        ],
        [
            "86.0966",
            "0.0681"
        ],
        [
            "87.0438",
            "0.2095"
        ],
        [
            "89.0592",
            "0.0447"
        ],
        [
            "91.0538",
            "0.4389"
        ],
        [
            "93.0697",
            "0.7639"
        ],
        [
            "94.0395",
            "0.0491"
        ],
        [
            "94.0732",
            "0.0637"
        ],
        [
            "95.0125",
            "0.0420"
        ],
        [
            "95.0490",
            "0.8268"
        ],
        [
            "95.0852",
            "0.8077"
        ],
        [
            "96.0519",
            "0.0854"
        ],
        [
            "97.0102",
            "0.0496"
        ],
        [
            "97.0282",
            "0.1063"
        ],
        [
            "97.0646",
            "0.6309"
        ],
        [
            "97.1010",
            "0.0454"
        ],
        [
            "98.0597",
            "0.0759"
        ],
        [
            "98.0713",
            "0.4089"
        ],
        [
            "99.0438",
            "0.9374"
        ],
        [
            "99.0802",
            "0.3758"
        ],
        [
            "100.0472",
            "0.1967"
        ],
        [
            "101.0593",
            "0.2725"
        ],
        [
            "103.0385",
            "0.1144"
        ],
        [
            "105.0334",
            "0.0587"
        ],
        [
            "105.0696",
            "0.6983"
        ],
        [
            "107.0488",
            "0.2646"
        ],
        [
            "107.0853",
            "0.7906"
        ],
        [
            "108.0887",
            "0.0516"
        ],
        [
            "109.0277",
            "0.0524"
        ],
        [
            "109.0509",
            "0.0734"
        ],
        [
            "109.0646",
            "0.7638"
        ],
        [
            "109.1009",
            "0.4343"
        ],
        [
            "110.0602",
            "0.0843"
        ],
        [
            "110.0675",
            "0.0766"
        ],
        [
            "111.0262",
            "0.1953"
        ],
        [
            "111.0438",
            "0.2746"
        ],
        [
            "111.0662",
            "0.0970"
        ],
        [
            "111.0802",
            "0.6932"
        ],
        [
            "112.0752",
            "0.0920"
        ],
        [
            "112.0823",
            "0.0490"
        ],
        [
            "113.0594",
            "0.5400"
        ],
        [
            "113.0782",
            "0.0498"
        ],
        [
            "113.0958",
            "0.0858"
        ],
        [
            "115.0387",
            "0.0987"
        ],
        [
            "115.0750",
            "0.0743"
        ],
        [
            "117.0695",
            "0.2582"
        ],
        [
            "119.0490",
            "0.0698"
        ],
        [
            "119.0853",
            "0.9255"
        ],
        [
            "119.2657",
            "0.0619"
        ],
        [
            "120.0808",
            "0.0782"
        ],
        [
            "120.0881",
            "0.1321"
        ],
        [
            "121.0649",
            "0.4111"
        ],
        [
            "121.1010",
            "0.7648"
        ],
        [
            "122.0596",
            "0.0768"
        ],
        [
            "122.0677",
            "0.0684"
        ],
        [
            "122.6336",
            "0.0578"
        ],
        [
            "123.0436",
            "0.2229"
        ],
        [
            "123.0662",
            "0.2045"
        ],
        [
            "123.0801",
            "0.7286"
        ],
        [
            "123.1164",
            "0.0918"
        ],
        [
            "124.0750",
            "0.0903"
        ],
        [
            "124.0835",
            "0.0894"
        ],
        [
            "125.0593",
            "0.4695"
        ],
        [
            "125.0961",
            "0.5416"
        ],
        [
            "126.0627",
            "0.0625"
        ],
        [
            "127.0387",
            "0.2483"
        ],
        [
            "127.0749",
            "0.5829"
        ],
        [
            "127.1108",
            "0.0568"
        ],
        [
            "128.0701",
            "0.0550"
        ],
        [
            "129.0541",
            "0.1708"
        ],
        [
            "129.0700",
            "0.1736"
        ],
        [
            "129.0908",
            "0.0808"
        ],
        [
            "131.0854",
            "0.4440"
        ],
        [
            "132.0886",
            "0.0603"
        ],
        [
            "133.0641",
            "0.1127"
        ],
        [
            "133.1008",
            "0.7634"
        ],
        [
            "134.1045",
            "0.1840"
        ],
        [
            "135.0441",
            "0.0830"
        ],
        [
            "135.0802",
            "0.8445"
        ],
        [
            "135.1164",
            "0.3262"
        ],
        [
            "136.0614",
            "0.3116"
        ],
        [
            "136.0746",
            "0.0805"
        ],
        [
            "136.0840",
            "0.4199"
        ],
        [
            "137.0596",
            "0.6065"
        ],
        [
            "137.0956",
            "0.4886"
        ],
        [
            "138.0768",
            "0.2147"
        ],
        [
            "139.0384",
            "0.1030"
        ],
        [
            "139.0751",
            "0.4913"
        ],
        [
            "139.1115",
            "0.2501"
        ],
        [
            "141.0542",
            "0.3841"
        ],
        [
            "141.0695",
            "0.0711"
        ],
        [
            "141.0908",
            "0.3093"
        ],
        [
            "141.5059",
            "0.1170"
        ],
        [
            "143.0699",
            "0.1075"
        ],
        [
            "143.0854",
            "0.4215"
        ],
        [
            "144.0888",
            "0.0549"
        ],
        [
            "145.0489",
            "0.0671"
        ],
        [
            "145.0642",
            "0.2375"
        ],
        [
            "145.1009",
            "0.8190"
        ],
        [
            "146.1044",
            "0.0569"
        ],
        [
            "147.0798",
            "0.4174"
        ],
        [
            "147.0908",
            "0.0492"
        ],
        [
            "147.1166",
            "0.5517"
        ],
        [
            "148.1193",
            "0.0681"
        ],
        [
            "149.0596",
            "0.1130"
        ],
        [
            "149.0959",
            "0.5689"
        ],
        [
            "149.1322",
            "0.0651"
        ],
        [
            "150.1000",
            "0.1953"
        ],
        [
            "151.0752",
            "0.5033"
        ],
        [
            "151.1113",
            "0.2474"
        ],
        [
            "152.0781",
            "0.0594"
        ],
        [
            "152.1145",
            "0.0494"
        ],
        [
            "153.0542",
            "0.2269"
        ],
        [
            "153.0726",
            "0.0541"
        ],
        [
            "153.0905",
            "0.3967"
        ],
        [
            "154.0949",
            "0.0683"
        ],
        [
            "154.1589",
            "0.0659"
        ],
        [
            "155.0701",
            "0.1864"
        ],
        [
            "155.0858",
            "0.1630"
        ],
        [
            "155.1060",
            "0.1842"
        ],
        [
            "157.0639",
            "0.0665"
        ],
        [
            "157.0881",
            "0.0652"
        ],
        [
            "157.1009",
            "0.6049"
        ],
        [
            "157.1218",
            "0.0645"
        ],
        [
            "159.0801",
            "0.3054"
        ],
        [
            "159.1163",
            "0.4184"
        ],
        [
            "160.1220",
            "0.0583"
        ],
        [
            "161.0592",
            "0.0747"
        ],
        [
            "161.0957",
            "0.7664"
        ],
        [
            "161.1070",
            "0.1217"
        ],
        [
            "161.1323",
            "0.3251"
        ],
        [
            "162.0992",
            "0.2574"
        ],
        [
            "163.0386",
            "0.0754"
        ],
        [
            "163.0748",
            "0.3522"
        ],
        [
            "163.1114",
            "0.7978"
        ],
        [
            "165.0880",
            "100.0000"
        ],
        [
            "166.0955",
            "0.0528"
        ],
        [
            "167.0695",
            "0.2306"
        ],
        [
            "167.0842",
            "0.1027"
        ],
        [
            "167.1060",
            "0.2867"
        ],
        [
            "168.1105",
            "0.1780"
        ],
        [
            "169.0635",
            "0.0470"
        ],
        [
            "169.0852",
            "0.3534"
        ],
        [
            "169.1008",
            "0.3209"
        ],
        [
            "169.6100",
            "0.0552"
        ],
        [
            "171.0798",
            "0.2752"
        ],
        [
            "171.1019",
            "0.0955"
        ],
        [
            "171.1160",
            "0.5817"
        ],
        [
            "172.1205",
            "0.2059"
        ],
        [
            "173.0950",
            "0.4187"
        ],
        [
            "173.1319",
            "0.2770"
        ],
        [
            "174.0997",
            "0.0862"
        ],
        [
            "175.0750",
            "0.2867"
        ],
        [
            "175.1112",
            "0.6819"
        ],
        [
            "176.1151",
            "0.0870"
        ],
        [
            "177.0536",
            "0.0535"
        ],
        [
            "177.0901",
            "0.2620"
        ],
        [
            "177.1031",
            "0.0978"
        ],
        [
            "177.1276",
            "0.0958"
        ],
        [
            "179.0537",
            "0.0440"
        ],
        [
            "179.0697",
            "0.2971"
        ],
        [
            "179.0898",
            "0.0843"
        ],
        [
            "179.1056",
            "0.7786"
        ],
        [
            "180.0733",
            "0.0599"
        ],
        [
            "180.1097",
            "0.2332"
        ],
        [
            "181.0851",
            "0.2885"
        ],
        [
            "181.1197",
            "0.7332"
        ],
        [
            "183.0639",
            "0.0682"
        ],
        [
            "183.0800",
            "0.1069"
        ],
        [
            "183.1003",
            "0.3441"
        ],
        [
            "183.1165",
            "0.2023"
        ],
        [
            "185.0597",
            "0.0529"
        ],
        [
            "185.0805",
            "0.0980"
        ],
        [
            "185.0959",
            "0.2781"
        ],
        [
            "185.1320",
            "0.3169"
        ],
        [
            "186.0989",
            "0.0692"
        ],
        [
            "187.0593",
            "0.0693"
        ],
        [
            "187.0751",
            "0.0980"
        ],
        [
            "187.0961",
            "0.0543"
        ],
        [
            "187.1115",
            "0.4066"
        ],
        [
            "187.1481",
            "0.0680"
        ],
        [
            "189.0897",
            "0.3580"
        ],
        [
            "189.1272",
            "0.3187"
        ],
        [
            "190.0941",
            "0.1167"
        ],
        [
            "190.1297",
            "0.2631"
        ],
        [
            "191.0692",
            "0.0751"
        ],
        [
            "191.1063",
            "0.3093"
        ],
        [
            "192.1099",
            "0.2219"
        ],
        [
            "193.0854",
            "0.2502"
        ],
        [
            "193.1010",
            "0.0831"
        ],
        [
            "193.1214",
            "0.2592"
        ],
        [
            "194.0893",
            "0.2128"
        ],
        [
            "195.0985",
            "60.9420"
        ],
        [
            "197.0583",
            "0.0736"
        ],
        [
            "197.0798",
            "0.0795"
        ],
        [
            "197.0959",
            "0.2072"
        ],
        [
            "197.1150",
            "0.1681"
        ],
        [
            "197.1325",
            "0.3000"
        ],
        [
            "199.0733",
            "0.0522"
        ],
        [
            "199.1111",
            "0.2465"
        ],
        [
            "199.1475",
            "0.0633"
        ],
        [
            "201.0891",
            "0.1040"
        ],
        [
            "201.1273",
            "0.2430"
        ],
        [
            "203.1055",
            "0.6031"
        ],
        [
            "203.1430",
            "0.1939"
        ],
        [
            "204.1098",
            "0.3443"
        ],
        [
            "204.1459",
            "0.2026"
        ],
        [
            "205.0833",
            "0.0672"
        ],
        [
            "205.1226",
            "0.2423"
        ],
        [
            "206.1254",
            "0.0699"
        ],
        [
            "207.0637",
            "0.0608"
        ],
        [
            "207.1011",
            "0.4304"
        ],
        [
            "207.1380",
            "0.1965"
        ],
        [
            "208.1041",
            "0.2366"
        ],
        [
            "209.0629",
            "0.0646"
        ],
        [
            "209.1162",
            "0.2635"
        ],
        [
            "211.0594",
            "0.2599"
        ],
        [
            "211.0766",
            "0.1125"
        ],
        [
            "211.0946",
            "0.1009"
        ],
        [
            "211.1112",
            "0.1584"
        ],
        [
            "211.1312",
            "0.1763"
        ],
        [
            "211.1477",
            "0.1809"
        ],
        [
            "212.1020",
            "0.0617"
        ],
        [
            "213.0911",
            "0.0858"
        ],
        [
            "213.1090",
            "0.5358"
        ],
        [
            "213.1274",
            "0.1692"
        ],
        [
            "213.1621",
            "0.0781"
        ],
        [
            "214.1287",
            "0.2220"
        ],
        [
            "215.0705",
            "0.0939"
        ],
        [
            "215.1064",
            "0.2673"
        ],
        [
            "215.1426",
            "0.0939"
        ],
        [
            "217.1225",
            "0.1118"
        ],
        [
            "219.1382",
            "0.1686"
        ],
        [
            "221.0793",
            "0.0703"
        ],
        [
            "221.0984",
            "0.1339"
        ],
        [
            "221.1166",
            "0.6485"
        ],
        [
            "221.1520",
            "0.1758"
        ],
        [
            "222.1207",
            "0.5172"
        ],
        [
            "222.1573",
            "0.0763"
        ],
        [
            "225.0550",
            "0.0586"
        ],
        [
            "225.0923",
            "0.2237"
        ],
        [
            "225.1106",
            "0.0961"
        ],
        [
            "225.1288",
            "0.1050"
        ],
        [
            "225.1465",
            "0.1328"
        ],
        [
            "226.0834",
            "0.0673"
        ],
        [
            "226.1136",
            "0.0662"
        ],
        [
            "229.0516",
            "0.0597"
        ],
        [
            "229.0842",
            "0.0595"
        ],
        [
            "229.1192",
            "0.0874"
        ],
        [
            "229.1355",
            "0.0597"
        ],
        [
            "231.1007",
            "0.1688"
        ],
        [
            "231.1370",
            "0.4530"
        ],
        [
            "232.1059",
            "0.3445"
        ],
        [
            "232.1404",
            "0.8258"
        ],
        [
            "234.1042",
            "0.0556"
        ],
        [
            "235.0953",
            "0.0799"
        ],
        [
            "237.1479",
            "0.0904"
        ],
        [
            "239.0705",
            "0.2228"
        ],
        [
            "239.1047",
            "0.3390"
        ],
        [
            "239.1267",
            "0.2037"
        ],
        [
            "240.0646",
            "0.0635"
        ],
        [
            "240.1013",
            "0.0580"
        ],
        [
            "240.1292",
            "0.3045"
        ],
        [
            "241.1401",
            "3.0279"
        ],
        [
            "243.0654",
            "0.2334"
        ],
        [
            "243.1140",
            "0.3454"
        ],
        [
            "243.1387",
            "0.1858"
        ],
        [
            "249.1121",
            "0.4095"
        ],
        [
            "249.1479",
            "0.6140"
        ],
        [
            "249.1830",
            "0.0743"
        ],
        [
            "250.0775",
            "0.0629"
        ],
        [
            "250.1149",
            "0.8469"
        ],
        [
            "250.1514",
            "1.6248"
        ],
        [
            "253.1075",
            "0.0814"
        ],
        [
            "257.0441",
            "0.0709"
        ],
        [
            "257.0796",
            "0.1014"
        ],
        [
            "257.0927",
            "0.0819"
        ],
        [
            "257.1260",
            "0.9190"
        ],
        [
            "257.1549",
            "0.3677"
        ],
        [
            "257.1902",
            "0.0964"
        ],
        [
            "258.1117",
            "0.1156"
        ],
        [
            "259.1467",
            "0.2067"
        ],
        [
            "259.1792",
            "0.0838"
        ],
        [
            "262.1122",
            "0.0571"
        ],
        [
            "267.0280",
            "0.0848"
        ],
        [
            "267.1022",
            "0.1245"
        ],
        [
            "267.1184",
            "0.1031"
        ],
        [
            "267.1385",
            "0.0838"
        ],
        [
            "267.1585",
            "0.2897"
        ],
        [
            "268.0938",
            "0.0744"
        ],
        [
            "268.1249",
            "1.1498"
        ],
        [
            "268.1610",
            "0.8133"
        ],
        [
            "271.1068",
            "1.4442"
        ],
        [
            "271.1501",
            "1.6565"
        ],
        [
            "275.1384",
            "0.0552"
        ],
        [
            "285.0388",
            "0.2642"
        ],
        [
            "285.0767",
            "0.4822"
        ],
        [
            "285.1180",
            "1.5612"
        ],
        [
            "285.1558",
            "0.9126"
        ],
        [
            "286.0766",
            "0.0758"
        ],
        [
            "286.1057",
            "0.1722"
        ],
        [
            "286.1369",
            "0.5853"
        ],
        [
            "286.1655",
            "0.0824"
        ],
        [
            "288.2101",
            "0.1061"
        ],
        [
            "289.1609",
            "0.5564"
        ],
        [
            "303.0479",
            "0.2677"
        ],
        [
            "303.0885",
            "0.4729"
        ],
        [
            "303.1306",
            "3.2588"
        ],
        [
            "303.1749",
            "12.6710"
        ],
        [
            "303.2117",
            "2.7710"
        ]
    ],
    "precursorType": "[M+H]+",
    "formula": "[C11H23N6O4]+",
    "name": "['tetra(methoxymethyl)melamine (putative)']",
    "kind": "biological",
    "smile": "N=1C(=NC(=[NH+]C1N(COC)COC)N(COC)COC)N",
    "inChiKey": "GDXYMSLKTXSGBS-UHFFFAOYSA-O",
    "inChi": "InChI=1S/C11H22N6O4/c1-18-5-16(6-19-2)10-13-9(12)14-11(15-10)17(7-20-3)8-21-4/h5-8H2,1-4H3,(H2,12,13,14,15)/p+1"
}
let canvasDiv = createSpectrumItemElementBySpectrumData(test2)
spectrumCart.createComparisonChartBySpectrumData(test,test1, canvasDiv)

async function mainAsync() {
    // createMessageIntoSpectrumContainer("Please key-in the parameter in the search bar and press the button to query for MS/MS spectrum.")
    // document.getElementById("search_button").onclick = OnClickFunctionForSearchSpectrum
    // let firstFetchData = await sentUrlParameterToAPI()
    // if (firstFetchData.length === 0) {
    //     createMessageIntoSpectrumContainer("No spectrum data found!! Please key-in the parameter in the search bar and press the button to query for MS/MS spectrum. ")
    // } else {
    //     document.getElementById("spectrum_container_div").innerHTML = ""
    //     firstFetchData.forEach(function (item) {
    //
    //         let canvasDiv = createSpectrumItemElementBySpectrumData(item)
    //         spectrumCart.createChartBySpectrumData(item["ms2SpectrumList"], canvasDiv)
    //     });
    //
    // }


}

async function sentUrlParameterToAPI() {
    function isUrlParameterValid(urlParameter) {
        if (urlParameter === undefined || urlParameter === null || urlParameter === "") {
            return false
        }
        return true
    }

    const url = new URL(window.location.href);
    const params = new URLSearchParams(url.search);
    if (params.size === 0) return
    let paramObject = {}
    params.forEach(function (value, key) {
        if (key === "keyWord" && isUrlParameterValid(value)) {
            paramObject["keyWord"] = value
        }
    })
    if (Object.keys(paramObject).length === 0) return

    let fetchUrl = fetchAPI.generateGetUrlByParameter(paramObject, "/api/spectrum/fuzzy")
    return await fetchAPI.fetchSpectrumDataByGetMethod(fetchUrl, {"method": "GET"})
}

async function OnClickFunctionForSearchSpectrum() {
    let getParameterObj = getSpectrumQueryParaFromForm()
    let fetchUrl = fetchAPI.generateGetUrlByParameter(getParameterObj, "/api/spectrum/")
    let fetchData = await fetchAPI.fetchSpectrumDataByGetMethod(fetchUrl, {"method": "GET"})
    document.getElementById("spectrum_container_div").innerHTML = ""
    if (fetchData.length === 0) {
        createMessageIntoSpectrumContainer("No spectrum data found")
        return
    }
    fetchData.forEach(function (item) {
        let canvasDiv = createSpectrumItemElementBySpectrumData(item)
        console.log(item)
        spectrumCart.createChartBySpectrumData(item["ms2SpectrumList"], canvasDiv)
    });
}


function getSpectrumQueryParaFromForm() {
    let getParameterObj = {
        spectrumInit: null,
        spectrumOffSet: null,
        compoundName: null,
        formula: null,
        authorId: null,
        msLevel: null,
        maxPrecursorMz: null,
        minPrecursorMz: null,
        maxExactMass: null,
        minExactMass: null,
        precursorType: null,
        ionMode: null,
        ms2Spectrum: null,
        ms2SpectrumSimilarityTolerance: null,
        isPassCheck: true
    }
    try {

        getParameterObj.compoundName = document.getElementById("compound_name_para").value
        getParameterObj.formula = document.getElementById("formula").value
        getParameterObj.ionMode = document.getElementById("charge").value
        getParameterObj.ms2Spectrum = document.getElementById("ms2Spectrum").value

        let tolerance_unit = document.getElementById("tolerance_unit").value
        let tolerance_value = parseFloat(document.getElementById("tolerance").value)
        let ms2_tolerance_value = parseFloat(document.getElementById("ms2_para").value)
        let exactMass = parseFloat(document.getElementById("exact_mass").value)
        let precursorMz = parseFloat(document.getElementById("precursor_mz").value)

        //計算出tolerance的值 - exact mass
        if (isNaN(exactMass) || exactMass === null || exactMass === undefined) {
            getParameterObj.maxExactMass = null
            getParameterObj.minExactMass = null
        } else {
            if (tolerance_unit === "ppm") {
                let deviationDa = exactMass * tolerance_value / 10 ** 6
                getParameterObj.maxExactMass = exactMass + deviationDa
                getParameterObj.minExactMass = exactMass - deviationDa

            } else if (tolerance_unit === "Da") {
                getParameterObj.maxExactMass = exactMass + tolerance_value
                getParameterObj.minExactMass = exactMass - tolerance_value
            }
        }

        //計算出tolerance的值 - precursor mz
        if (isNaN(precursorMz) || precursorMz === null || precursorMz === undefined) {
            getParameterObj.maxPrecursorMz = null
            getParameterObj.minPrecursorMz = null
        } else {
            if (tolerance_unit === "ppm") {
                let deviationMz = precursorMz * tolerance_value / 10 ** 6
                getParameterObj.maxPrecursorMz = precursorMz + deviationMz
                getParameterObj.minPrecursorMz = precursorMz - deviationMz

            } else if (tolerance_unit === "Da") {
                getParameterObj.maxPrecursorMz = precursorMz + tolerance_value
                getParameterObj.minPrecursorMz = precursorMz - tolerance_value
            }
        }

        let keys = Object.keys(getParameterObj)
        for (let i = 0; i < keys.length; i++) {
            if (getParameterObj[keys[i]] === "" || getParameterObj[keys[i]] === undefined) {
                getParameterObj[keys[i]] = null
            }
        }


    } catch (e) {
        console.log(e)

        //if any failed data is not valid, then set the isPassCheck to false
        getParameterObj.isPassCheck = false
        return null
    }

    if (getParameterObj.isPassCheck === false) {
        alert("Please check your input data")
    }

    return getParameterObj
}


function createSpectrumItemElementBySpectrumData(spectrumDataObj) {


    let containerDiv = document.getElementById("spectrum_container_div");

    let itemDiv = document.createElement("div");
    itemDiv.className = "spectrum_item_div";

    let canvasDiv = document.createElement("div");
    canvasDiv.className = "spectrum_canvas_div";

    let canvas = document.createElement("canvas");
    canvas.className = "spectrumChart";

    canvasDiv.appendChild(canvas);

    let infoDiv = document.createElement("div");
    infoDiv.className = "spectrum_info_div";

    let table = document.createElement("table");

    //preprocess the data for undefined or null data
    let spectrumDataObjKeys = Object.keys(spectrumDataObj)
    for (let i = 0; i < spectrumDataObjKeys.length; i++) {
        if (spectrumDataObj[spectrumDataObjKeys[i]] == null || spectrumDataObj[spectrumDataObjKeys[i]] === undefined) {
            spectrumDataObj[spectrumDataObjKeys[i]] = "N/A"
        }
    }

    let tableContent = [
        ["Compound Name:", `${spectrumDataObj.name}`],
        ["Exact Mass:", `${spectrumDataObj.exactMass}`],
        ["Formula:", `${spectrumDataObj.formula}`],
        ["InChi key", `${spectrumDataObj.inChiKey}`],
        ["Charge:", `${spectrumDataObj.ionMode}`],
        ["Collision Energy:", `${spectrumDataObj.collisionEnergy}`],
        ["Precursor m/z:", `${spectrumDataObj.precursorMz}`],
        ["Adduct ion:", `${spectrumDataObj.precursorType}`],
        ["Tool type:", `${spectrumDataObj.toolType}`],
        ["SMILE:", `${spectrumDataObj.smile}`]
    ];

    for (let i = 0; i < tableContent.length; i++) {
        let row = document.createElement("tr");
        let th = document.createElement("th");
        th.textContent = tableContent[i][0];
        let td = document.createElement("td");
        td.textContent = tableContent[i][1];
        row.appendChild(th);
        row.appendChild(td);
        table.appendChild(row);
    }
    infoDiv.appendChild(table);
    itemDiv.appendChild(canvasDiv);
    itemDiv.appendChild(infoDiv);
    containerDiv.appendChild(itemDiv);
    return canvas;

}


function createMessageIntoSpectrumContainer(message) {
    let containerDiv = document.getElementById("spectrum_container_div");
    containerDiv.innerHTML = `<div class="spectrum_item_div">
			<h1>${message}</h1>
		</div>`
}